#
# TA-kaspersky
# props.conf
#

#
# Configuration using the LEEF option
#
[kaspersky]
pulldown_type = true
category = Network & Security
description = Kaspersky ES events (LEEF)

MAX_TIMESTAMP_LOOKAHEAD=512
SHOULD_LINEMERGE = false
disabled = false

TRANSFORMS-rename = kaspersky_threat, kaspersky_devctrl, kaspersky_system, kaspersky_appctrl

###### CIM FIELDS ######
### Malware Attacks
FIELDALIAS-date = devTime AS date
EVAL-dest = coalesce(dest_name,dest_ip,dest_host)
FIELDALIAS-destname = identNetBios AS dest_name
FIELDALIAS-destip = identSrc AS dest_ip
EXTRACT-file = EVC_EV_FILE_Name=(?<file_path>(?:(?:[^\\]+)(?:[\\]+))+)(?<file_name>[^\t]*)
EVAL-src = coalesce(src_name,src_ip,src_host)
EXTRACT-user = User[\:\=]\s?(?:[^\\]*\\)?(?<user>[^\s\r\n]*)
FIELDALIAS-vendorproduct = EVC_EV_KL_PRODUCT_NAME AS vendor_product

### Malware Operations
FIELDALIAS-productversion = EVC_EV_KL_PRODUCT_VER AS product_version

#
# Configuration using the CEF format
#
[kaspersky:cef]
pulldown_type = true
category = Network & Security
description = Kaspersky ES events (CEF)

TIME_FORMAT = %s
TIME_PREFIX = rt\=
#MAX_TIMESTAMP_LOOKAHEAD = 15
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\n\r]+)
TRUNCATE = 999999

TRANSFORMS-rename = kaspersky_threat, kaspersky_devctrl, kaspersky_system, kaspersky_appctrl

#
# Renamed sourcetypes
#
[kaspersky:threat]
pulldown_type = false
MAX_TIMESTAMP_LOOKAHEAD=512
SHOULD_LINEMERGE=false
disabled=false

###### CIM FIELDS ######
### Malware Attacks
EXTRACT-vendoraction = Result\\Description\:\s+(?<vendor_action>[^\\]*)
FIELDALIAS-date = devTime AS date
EVAL-dest = coalesce(dest_name,dest_ip,dest_host)
FIELDALIAS-destname = identNetBios AS dest_name
FIELDALIAS-destip = identSrc AS dest_ip
EXTRACT-file = EVC_EV_FILE_Name=(?<file_path>(?:(?:[^\\]+)(?:[\\]+))+)(?<file_name>[^\t]*)
EXTRACT-signature = (?:(?:Result\\Name\:\s+)|(?:Untreated\:\s+)|(?:Deleted\:\s+))(?<signature>[^\\|\s]*)
EVAL-signature = coalesce(signature,EVC_EV_VIRUS_NAME)
EVAL-src = coalesce(src_name,src_ip,src_host)
EXTRACT-src = Object\:\s+(?<protocol>[^\s]*)\s+from\s+(?<src_ip>[^\s]*)\s+to\s+local\s+port\s+(?<dest_port>[\d]*)
EXTRACT-user = User[\:\=][\s\t]?(?:[^\\]*\\)?(?<user>.*)(?:\\r\\n)C
FIELDALIAS-vendorproduct = EVC_EV_KL_PRODUCT_NAME AS vendor_product

### Malware Operations
FIELDALIAS-productversion = EVC_EV_KL_PRODUCT_VER AS product_version

### Other
LOOKUP-kaspersky_action_to_action = kaspersky_sc_actions vendor_action OUTPUT action


[kaspersky:devctrl]
pulldown_type = false
disabled = false

TIME_PREFIX = devTime=
TIME_FORMAT = %Y-%m-%d %H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 19
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\n\r]+)
TRUNCATE = 999999

FIELDALIAS-date = devTime AS date

EXTRACT-file = EVC_EV_FILE_Name=(?<file_path>(?:(?:[^\\]+)(?:[\\]+))+)(?<file_name>[^\t]*)

FIELDALIAS-srcname = identNetBios AS src_name
FIELDALIAS-srcip = identSrc AS src_ip
EVAL-src = coalesce(src_name,src_ip,src_host)

FIELDALIAS-destname = identNetBios AS dest_name
FIELDALIAS-destip = identSrc AS dest_ip
EVAL-dest = coalesce(dest_name,dest_ip,dest_host)

EXTRACT-user = User:\s+(?<user>[^\(]*)
EVAL-user = coalesce(user,usrName)

FIELDALIAS-vendorproduct = EVC_EV_KL_PRODUCT_NAME AS vendor_product
FIELDALIAS-productversion = EVC_EV_KL_PRODUCT_VER AS product_version


[kaspersky:system]
pulldown_type = false
MAX_TIMESTAMP_LOOKAHEAD=512
SHOULD_LINEMERGE=false
disabled=false

###### CIM FIELDS ######
### Malware Attacks
FIELDALIAS-date = devTime AS date
FIELDALIAS-destname = identNetBios AS dest_name
FIELDALIAS-destip = identSrc AS dest_ip
EVAL-dest = coalesce(dest_name,dest_ip,dest_host)
EVAL-src = coalesce(src_name,src_ip,src_host)
EXTRACT-user = User:\s+(?<user>[^\(]*)
EVAL-user = coalesce(user,usrName)
FIELDALIAS-vendorproduct = EVC_EV_KL_PRODUCT_NAME AS vendor_product

### Malware Operations
FIELDALIAS-productversion = EVC_EV_KL_PRODUCT_VER AS product_version


[kaspersky:appctrl]
pulldown_type = false
MAX_TIMESTAMP_LOOKAHEAD=512
SHOULD_LINEMERGE=false
disabled=false

###### CIM FIELDS ######
### Malware Attacks
FIELDALIAS-date = devTime AS date
EVAL-dest = coalesce(dest_name,dest_ip,dest_host)
FIELDALIAS-destname = identNetBios AS dest_name
FIELDALIAS-destip = identSrc AS dest_ip
EVAL-src = coalesce(src_name,src_ip,src_host)
FIELDALIAS-vendorproduct = EVC_EV_KL_PRODUCT_NAME AS vendor_product

### Malware Operations
FIELDALIAS-productversion = EVC_EV_KL_PRODUCT_VER AS product_version



[kaspersky:audit]

